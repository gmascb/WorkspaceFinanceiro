USE MASTER
CREATE DATABASE PROJETO
USE PROJETO
--CRIANDO TABELAS

--CRIANDO TABELA CONTA/CAIXA
CREATE TABLE FCXA (
  CODCXA INTEGER NOT NULL,
  DESCRICAO VARCHAR(20) NOT NULL,
  SALDOINICIAL DECIMAL NOT NULL,
  SALDOATUAL DECIMAL NOT NULL,
  PRIMARY KEY(CODCXA)
); 

--CRIANDO TABELA CLI/FOR
CREATE TABLE FCFO (
  CODCFO INTEGER NOT NULL,
  NOME VARCHAR(40) NULL,
  CGCCFO VARCHAR(18) NULL,
  ENDERECO VARCHAR(40) NULL,
  TELEFONE VARCHAR(20) NULL,
  PRIMARY KEY (CODCFO)
);

--CRIANDO TABELA TIPO DE DOCUMENTO
CREATE TABLE FTDO (
  CODTDO INTEGER NOT NULL,
  NOME VARCHAR(40) NULL,
  PAGREC INTEGER NULL,
  PRIMARY KEY(CODTDO)
);

--CRIANDO TABELA EXTRATO DE CAIXA
CREATE TABLE FXCX (
  IDXCX INTEGER NOT NULL,
  VALOR DECIMAL NULL,
  NUMERODOCUMENTO INTEGER  NULL,
  COMPENSADO INTEGER NOT NULL,
  IDLAN INTEGER NULL ,
  CODCXA INTEGER NOT NULL,
  DATA DATE NOT NULL,
  DATACOMPENSACAO DATE NULL,
  PRIMARY KEY(IDXCX),
);

CREATE TABLE FLAN (
  IDLAN INTEGER NOT NULL ,
  NUMERODOCUMENTO INTEGER  NOT NULL,
  CODCXA INTEGER  NULL,
  CODCFO INTEGER  NOT NULL,
  CODTDO INTEGER  NOT NULL,
  IDXCX INTEGER  NULL,
  DATAEMISSAO DATE NOT NULL,
  DATAVENCIMENTO DATE NOT NULL,
  VALORORIGINAL DECIMAL NOT NULL,
  VALORJUROS DECIMAL NULL,
  VALORMULTA DECIMAL NULL,
  VALORDESCONTO DECIMAL NULL,
  PAGREC INTEGER  NOT NULL,
  STATUSLAN INTEGER  NULL,
  DATABAIXA DATE NULL,
  VALORBAIXA DECIMAL NULL,
  PRIMARY KEY(IDLAN),
);


--ALTERANDO TABELA INCLUINDO FOREIGN KEY]

ALTER TABLE FXCX
ADD FOREIGN KEY (IDLAN) REFERENCES FLAN(IDLAN)

ALTER TABLE FXCX
ADD FOREIGN KEY (CODCXA) REFERENCES FCXA(CODCXA)


ALTER TABLE FLAN
ADD FOREIGN KEY (CODCXA) REFERENCES FCXA(CODCXA)

ALTER TABLE FLAN
ADD FOREIGN KEY (CODCFO) REFERENCES FCFO(CODCFO)


ALTER TABLE FLAN
ADD FOREIGN KEY (IDXCX) REFERENCES FXCX(IDXCX)


ALTER TABLE FLAN
ADD FOREIGN KEY (CODTDO) REFERENCES FTDO(CODTDO)



--Alterando propriedade da coluna
ALTER TABLE FLAN
ALTER COLUMN DATABAIXA DATE NULL

ALTER TABLE FLAN
ALTER COLUMN VALORBAIXA DECIMAL NULL


--EXEMPLO DROPANDO COLUNAS
ALTER TABLE FLAN
DROP COLUMN FCXA_CODCXA

--ALTERANDO TABELA INCLUINDO COLUNA
ALTER TABLE FXCX
ADD CODCXA INTEGER NOT NULL

--CRIANDO INDICE NA COLUNA DE UMA TABELA
--CRIA INDICE 'NOME DO INDICE' NA 'TABELA' ('CAMPO')

CREATE INDEX FKFXCX_FLAN ON FXCX(IDXCX)
CREATE INDEX FKFXCX_FCXA ON FXCX (CODCXA)
CREATE INDEX FLAN_FXCX ON FXCX(IDXCX)
CREATE INDEX FLAN_FTDO ON FTDO(CODTDO)
CREATE INDEX FLAN_FCFO ON FCFO(CODCFO)
CREATE INDEX FLAN_FCXA ON FCXA(CODCXA)

--DROPA OS INDICES
DROP INDEX FKFXCX_FLAN ON FXCX
DROP INDEX FKFXCX_FCXA ON FXCX
DROP INDEX FLAN_FXCX ON FXCX
DROP INDEX FLAN_FTDO ON FTDO
DROP INDEX FLAN_FCFO ON FCFO
DROP INDEX FLAN_FCXA ON FCXA


--POPULANDO TABELAS

INSERT INTO FCXA (CODCXA,SALDOATUAL,SALDOINICIAL) VALUES (1,0.0,0.0)

INSERT INTO FCFO (CODCFO,NOME,CGCCFO,ENDERECO,TELEFONE) VALUES (1,2,'AAAA','RUA','51321')

INSERT INTO FTDO (CODTDO,NOME,PAGREC) VALUES (1,'BOLETO',1)

INSERT INTO FXCX VALUES (1,19.0,123123,1,1,1)

INSERT INTO FLAN VALUES(1,12345,1,1,1,NULL,GETDATE(),GETDATE(),111,10,1,NULL,1,0)


--- Criando usuario rm na base
IF NOT EXISTS(SELECT * FROM MASTER.DBO.SYSLOGINS WHERE NAME = 'rm')
   CREATE LOGIN rm WITH PASSWORD = 'rm',CHECK_POLICY=OFF,DEFAULT_LANGUAGE = us_english
GO


--Antes de RODAR ESSA PERMISSAO é necessário acessar a pasta Security > Logins, da Instancia  e clicar com botão direito --properties, ir até a etapa User Mapping.
--Marcar o banco de dados que o usuário poderá acessar.

--- Dando permissões de SELECT, UPDATE e DELETE 
GRANT INSERT ON FLAN TO rm
GO
GRANT SELECT ON FLAN TO rm
GO
GRANT UPDATE ON FLAN TO rm
GO
GRANT DELETE ON FLAN TO rm
GO
GRANT INSERT ON FXCX TO rm
GO
GRANT SELECT ON FXCX TO rm
GO
GRANT UPDATE ON FXCX TO rm
GO
GRANT DELETE ON FXCX TO rm
GO
GRANT INSERT ON FCFO TO rm
GO
GRANT SELECT ON FCFO TO rm
GO
GRANT UPDATE ON FCFO TO rm
GO
GRANT DELETE ON FCFO TO rm
GO
GRANT INSERT ON FTDO TO rm
GO
GRANT SELECT ON FTDO TO rm
GO
GRANT UPDATE ON FTDO TO rm
GO
GRANT DELETE ON FTDO TO rm
GO
GRANT INSERT ON FCXA TO rm
GO
GRANT SELECT ON FCXA TO rm
GO
GRANT UPDATE ON FCXA TO rm
GO
GRANT DELETE ON FCXA TO rm
GO




